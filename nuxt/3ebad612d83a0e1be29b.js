(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{265:function(e,t,n){"use strict";n.r(t);n(128),n(4),n(57);var r,o,c,d,l=n(13),h=(n(54),n(227)),m=(n(228),{mixins:[{data:function(){return{init_time:0,app_id:7177213,group_id:148056070,access_token:"",loading:!1}},computed:{hash:function(){try{var e=decodeURIComponent(window.location.hash.split("#")[1]);return console.log({encoded:e}),e}catch(e){console.log(e)}return null}},methods:{fetchData:(d=Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.sendPromise("VKWebAppGetUserInfo");case 2:this.user=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)}),init:(c=Object(l.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return data={method:"groups.isMember",request_id:"test22",params:{v:"5.102",access_token:window.token,group_id:this.group_id}},e.next=3,h.sendPromise("VKWebAppCallAPIMethod",data);case 3:0===e.sent.response&&h.send("VKWebAppJoinGroup",{group_id:this.group_id});case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),PayloadStorageUpload:(o=Object(l.a)(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).getTime()+Math.floor(1e5*Math.random()),t.random=n,e.next=4,h.sendPromise("VKWebAppSendPayload",{group_id:this.group_id,payload:t});case 4:return r=e.sent,console.log("token",window.token),console.log({VKWebAppSendPayload:r}),e.next=9,new Promise((function(e,t){var i=1;function r(){return o.apply(this,arguments)}function o(){return(o=Object(l.a)(regeneratorRuntime.mark((function o(){var c,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return i++,o.next=3,h.sendPromise("VKWebAppCallAPIMethod",{method:"storage.get",request_id:n,params:{v:"5.102",access_token:window.token,key:"upload"}});case 3:c=o.sent,d=JSON.parse(c.response),console.log({json:d},n,d.random),Number(d.random)===n?e(d):i>20?t("Result not finded!"):setTimeout(r,350);case 7:case"end":return o.stop()}}),o)})))).apply(this,arguments)}r()}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),poster:(r=Object(l.a)(regeneratorRuntime.mark((function e(){var t,n,r,o,c,d,l,m,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,e.prev=1,window.token){e.next=5;break}return this.get_access(),e.abrupt("return");case 5:return e.next=7,h.sendPromise("VKWebAppCallAPIMethod",{method:"photos.getWallUploadServer",request_id:"32test",params:{v:"5.102",access_token:window.token}});case 7:return t=e.sent,n=t.response,r=n.upload_url,o=n.user_id,e.next=11,this.PayloadStorageUpload({upload_url:r,user_id:o,photo:this.hash.substr(7,100)});case 11:return c=e.sent,e.next=14,h.sendPromise("VKWebAppCallAPIMethod",{method:"photos.saveWallPhoto",request_id:"33test",params:{v:"5.102",access_token:this.access_token,user_id:o,photo:c.photo,hash:c.hash,server:c.server,caption:"@art_privet(Арт за 5 сек)"}});case 14:return d=e.sent,l=d.response[0],m=l.id,f=l.owner_id,v="photo"+f+"_"+m,e.next=19,h.sendPromise("VKWebAppShowWallPostBox",{message:"@art_privet(Арт за 5 сек)",attachments:v});case 19:h.send("VKWebAppAddToFavorites",{}),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),console.error(e.t0);case 25:this.loading=!1;case 26:case"end":return e.stop()}}),e,this,[[1,22]])}))),function(){return r.apply(this,arguments)}),get_access:function(){h.send("VKWebAppGetAuthToken",{app_id:this.app_id,scope:"wall,photos"})}},mounted:function(){var e=this;console.log({connect:h}),window.connect=h,h.subscribe((function(t){var n=t.detail,r=n.type,data=n.data;if(console.log("onConnect",r,data),"VKWebAppUpdateConfig"===r){var o=document.createAttribute("scheme");o.value=data.scheme?data.scheme:"client_light",document.body.attributes.setNamedItem(o)}"VKWebAppAccessTokenReceived"===r&&(e.access_token=data.access_token,window.token=data.access_token,e.init())})),this.get_access(),this.fetchData()}}]}),f=n(44),v=n(118),_=n.n(v),w=n(214),k=n(264),x=n(262),y=n(266),A=n(263),component=Object(f.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{staticClass:"ma-0"},[e.hash.indexOf("http")>-1?n("div",[n("div",{staticClass:"pt-5 pa-5 mt-5 align-center justify-center"},[n("v-img",{style:{width:"calc(95vmin)","border-radius":"3%"},attrs:{alt:"img",src:"http://"+e.hash.substr(6,100)}})],1),e._v(" "),n("v-layout",{staticClass:"justify-center"},[n("v-btn",{staticClass:"green outlined white--text",attrs:{loading:e.loading,outlined:""},on:{click:e.poster}},[e._v("\n        Сохранить\n      ")])],1)],1):n("div",{staticClass:"grey pa-5 justify-center d-flex",style:{height:"100%"}},[n("div",{staticClass:"mt-5 pt-5 ",style:{width:"95%",height:"95%"}},[n("v-flex",{staticClass:"justify-center"},[n("v-img",{attrs:{src:"/images/demo.jpg"}})],1),e._v(" "),n("v-flex",{staticClass:"justify-center mt-2"},[n("v-btn",{staticClass:"orange white--text"},[e._v("Создать новый арт")])],1)],1)])])}),[],!1,null,null,null);t.default=component.exports;_()(component,{VApp:w.a,VBtn:k.a,VFlex:x.a,VImg:y.a,VLayout:A.a})}}]);