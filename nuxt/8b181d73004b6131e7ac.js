(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{265:function(e,t,n){"use strict";n.r(t);n(128),n(4),n(57);var r=n(13),o=(n(54),n(227));o.send("VKWebAppInit",{});n(228);var c,d,l,h,m={mixins:[{data:function(){return{init_time:0,app_id:7177213,group_id:148056070,access_token:"",loading:!1}},computed:{hash:function(){try{var e=decodeURIComponent(window.location.hash.split("#")[1]);return console.log({encoded:e}),e}catch(e){console.log(e)}return null}},methods:{fetchData:(h=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.sendPromise("VKWebAppGetUserInfo");case 2:this.user=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)}),init:(l=Object(r.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return data={method:"groups.isMember",request_id:"test22",params:{v:"5.102",access_token:window.token,group_id:this.group_id}},e.next=3,o.sendPromise("VKWebAppCallAPIMethod",data);case 3:0===e.sent.response&&o.send("VKWebAppJoinGroup",{group_id:this.group_id});case 5:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)}),PayloadStorageUpload:(d=Object(r.a)(regeneratorRuntime.mark((function e(t){var n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).getTime()+Math.floor(1e5*Math.random()),t.random=n,e.next=4,o.sendPromise("VKWebAppSendPayload",{group_id:this.group_id,payload:t});case 4:return c=e.sent,console.log("token",window.token),console.log({VKWebAppSendPayload:c}),e.next=9,new Promise((function(e,t){var i=1;function c(){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(regeneratorRuntime.mark((function r(){var d,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i++,r.next=3,o.sendPromise("VKWebAppCallAPIMethod",{method:"storage.get",request_id:n,params:{v:"5.102",access_token:window.token,key:"upload"}});case 3:d=r.sent,l=JSON.parse(d.response),console.log({json:l},n,l.random),Number(l.random)===n?e(l):i>20?t("Result not finded!"):setTimeout(c,350);case 7:case"end":return r.stop()}}),r)})))).apply(this,arguments)}c()}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)}),poster:(c=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,c,d,l,h,m,v,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,e.prev=1,window.token){e.next=5;break}return this.get_access(),e.abrupt("return");case 5:return e.next=7,o.sendPromise("VKWebAppCallAPIMethod",{method:"photos.getWallUploadServer",request_id:"32test",params:{v:"5.102",access_token:window.token}});case 7:return t=e.sent,n=t.response,r=n.upload_url,c=n.user_id,e.next=11,this.PayloadStorageUpload({upload_url:r,user_id:c,photo:this.hash.substr(7,100)});case 11:return d=e.sent,e.next=14,o.sendPromise("VKWebAppCallAPIMethod",{method:"photos.saveWallPhoto",request_id:"33test",params:{v:"5.102",access_token:this.access_token,user_id:c,photo:d.photo,hash:d.hash,server:d.server,caption:"@art_privet(Арт за 5 сек)"}});case 14:return l=e.sent,h=l.response[0],m=h.id,v=h.owner_id,f="photo"+v+"_"+m,e.next=19,o.sendPromise("VKWebAppShowWallPostBox",{message:"@art_privet(Арт за 5 сек)",attachments:f});case 19:o.send("VKWebAppAddToFavorites",{}),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),console.error(e.t0);case 25:this.loading=!1;case 26:case"end":return e.stop()}}),e,this,[[1,22]])}))),function(){return c.apply(this,arguments)}),get_access:function(){o.send("VKWebAppGetAuthToken",{app_id:this.app_id,scope:"wall,photos"})}},mounted:function(){var e=this;console.log({connect:o}),window.connect=o,o.subscribe((function(t){var n=t.detail,r=n.type,data=n.data;if(console.log("onConnect",r,data),"VKWebAppUpdateConfig"===r){var o=document.createAttribute("scheme");o.value=data.scheme?data.scheme:"client_light",document.body.attributes.setNamedItem(o)}"VKWebAppAccessTokenReceived"===r&&(e.access_token=data.access_token,window.token=data.access_token,e.init())})),this.get_access(),this.fetchData()}}]},v=n(44),f=n(118),_=n.n(f),w=n(214),k=n(264),x=n(262),y=n(266),A=n(263),component=Object(v.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{staticClass:"ma-0"},[e.hash.indexOf("http")>-1?n("div",[n("div",{staticClass:"pt-5 pa-5 mt-5 align-center justify-center"},[n("v-img",{style:{width:"calc(95vmin)","border-radius":"3%"},attrs:{alt:"img",src:"//"+e.hash.substr(7,100)}})],1),e._v(" "),n("v-layout",{staticClass:"justify-center"},[n("v-btn",{staticClass:"green outlined white--text",attrs:{loading:e.loading,outlined:""},on:{click:e.poster}},[e._v("\n        Сохранить\n      ")])],1)],1):n("div",{staticClass:"grey pa-5 justify-center d-flex",style:{height:"100%"}},[n("div",{staticClass:"mt-5 pt-5 ",style:{width:"95%",height:"95%"}},[n("v-flex",{staticClass:"justify-center"},[n("v-img",{attrs:{src:"/vk_art/images/demo.jpg"}})],1),e._v(" "),n("v-flex",{staticClass:"justify-center mt-2"},[n("v-btn",{staticClass:"orange white--text"},[e._v("Создать новый арт")])],1)],1)])])}),[],!1,null,null,null);t.default=component.exports;_()(component,{VApp:w.a,VBtn:k.a,VFlex:x.a,VImg:y.a,VLayout:A.a})}}]);